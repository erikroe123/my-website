<!DOCTYPE html>
<html>
<head>
    <title>Flappy ZITA Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            overflow: hidden;
            background: linear-gradient(to bottom, #56CCF2, #2F80ED);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100dvh;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }
        #gameContainer {
            position: relative;
            width: 100%;
            max-width: 400px;
            aspect-ratio: 9/16;
            margin: auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
            background: linear-gradient(to bottom, #4EC0CA, #2BB9E6);
            outline: none;
        }
        #starwars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            perspective: 400px;
            background: black;
            color: yellow;
            font-family: 'Arial', sans-serif;
            text-align: center;
            overflow: hidden;
            display: none;
            z-index: 100;
        }
        #crawl {
            position: relative;
            top: 100%;
            transform-origin: 50% 100%;
            animation: crawl 40s linear;
            font-size: 36px;
            font-weight: bold;
            line-height: 1.5;
            z-index: 180;
        }
        @keyframes crawl {
            0% {
                top: 100%;
                transform: rotateX(20deg) translateZ(0);
            }
            100% {
                top: -500%;
                transform: rotateX(25deg) translateZ(-500px);
            }
        }
        #starwars-title {
            font-size: 48px;
            margin-bottom: 30px;
            text-transform: uppercase;
        }
        #startText {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            color: white;
            text-shadow: 0 0 10px black;
            z-index: 50;
            display: none;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .fly-in {
            animation: flyIn 1.5s ease-out forwards;
        }
        @keyframes flyIn {
            0% {
                transform: translateX(-300px) rotate(-30deg);
                opacity: 0;
            }
            100% {
                transform: translateX(0) rotate(0);
                opacity: 1;
            }
        }
        #score {
            position: absolute;
            top: 5%;
            left: 50%;
            transform: translateX(-50%);
            font-size: clamp(24px, 6vw, 32px);
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 10;
            font-weight: bold;
        }
        #gameOver {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 20;
            text-align: center;
        }
        #gameOver h1 {
            font-size: clamp(28px, 7vw, 36px);
            margin-bottom: 15px;
            color: #FFD700;
        }
        #finalScore {
            font-size: clamp(20px, 5vw, 24px);
            margin-bottom: 25px;
        }
        #restartBtn {
            margin-top: 20px;
            padding: 12px 30px;
            background: #FFD700;
            border: none;
            border-radius: 30px;
            font-size: clamp(18px, 4.5vw, 22px);
            cursor: pointer;
            font-weight: bold;
            color: #333;
            transition: transform 0.2s, background 0.2s;
        }
        #restartBtn:active {
            transform: scale(0.95);
            background: #FFC000;
        }
        #controls {
            position: absolute;
            bottom: 8%;
            width: 100%;
            display: flex;
            justify-content: center;
            z-index: 15;
        }
        #jumpBtn {
            padding: 20px 40px;
            background: rgba(255,215,0,0.7);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: clamp(18px, 4.5vw, 22px);
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: transform 0.1s, background 0.2s;
            display: none;
        }
        #jumpBtn:active {
            transform: scale(0.95);
            background: rgba(255,195,0,0.8);
        }
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 30;
            text-align: center;
        }
        #startScreen h1 {
            font-size: clamp(28px, 7vw, 36px);
            margin-bottom: 20px;
            color: #FFD700;
        }
        #startBtn {
            margin-top: 30px;
            padding: 15px 40px;
            background: #FFD700;
            border: none;
            border-radius: 30px;
            font-size: clamp(20px, 5vw, 24px);
            cursor: pointer;
            font-weight: bold;
            color: #333;
            transition: transform 0.2s, background 0.2s;
        }
        #startBtn:active {
            transform: scale(0.95);
            background: #FFC000;
        }
        .instructions {
            font-size: clamp(14px, 3.5vw, 16px);
            margin: 10px 20px;
            line-height: 1.5;
        }
        #countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 72px;
            color: white;
            text-shadow: 0 0 10px black;
            z-index: 50;
            display: none;
        }
        @media (max-width: 768px) {
            #gameContainer {
                max-width: 100%;
                height: 100%;
                border-radius: 0;
            }
            #jumpBtn {
                display: block;
            }
        }
        #blocker {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 200;
            display: none;
        }
        #blocker:active {
            background: rgba(0,0,0,0.1);
            transition: background 0.2s;
        }
        .minion {
            position: absolute;
            width: 80px;
            height: auto;
            z-index: 150;
            animation: floatMinion 10s linear infinite;
            pointer-events: none;
            left: unset;
            right: unset;
        }
        @keyframes floatMinion {
            0% { transform: translateX(0) translateY(0) rotate(0deg); }
            50% { transform: translateX(10px) translateY(-20px) rotate(5deg); }
            100% { transform: translateX(0) translateY(0) rotate(0deg); }
        }
        @keyframes floatMinion2 {
            0% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-30px) rotate(5deg); }
            100% { transform: translateY(0) rotate(-5deg); }
        }
        .minion:nth-child(odd) {
            animation: floatMinion 8s ease-in-out infinite;
        }
        .minion:nth-child(even) {
            animation: floatMinion2 12s linear infinite;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .fade-in {
            animation: fadeIn 2s ease-in forwards;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="score">0</div>
        <div id="countdown">3</div>
        <div id="startText">MULAI!</div>
        <div id="blocker"></div>

        <div id="minion-templates" style="display:none;">
            <img src="bob1.png" class="minion-img">
            <img src="bob2.png" class="minion-img">
            <img src="bob3.png" class="minion-img">
        </div>

        <img id="bgFar" src="gunung.jpg" style="display:none;">
        <img id="bgNear" src="awan.png" style="display:none;">
        <canvas id="gameCanvas" tabindex="0"></canvas>

        <div id="starwars">
            <div id="crawl">
                <div id="starwars-title">Selamat Ulang Tahun Ke 24th</div>
                <p>Selamat Ulang Tahun!</p>
                <p>Buat kamu Arstia Zita</p>
                <p>tak terase Zite Kecil ni dah besah rupanye yeee hehe</p>
                <p>Di usia ke 24 ini, aku berdoa untukmu</p>
                <p>semoga kamu selalu diberi kesehatan,</p>
                <p>kelapangan rezeki,</p>
                <p>semoga setiap langkah yang kamu ambil,</p>
                <p>mendekatkanmu pada versi terbaik dari dirimu yang lalu.</p>
                <p>semoga Allah membimbing kamu dalam setiap keputusan penting.</p>
                <p>dan juga kamu harus ingat</p>
                <p>harus sering bersyukur yaa..</p>
                <p>makin rajin solat nya yaa, rajin bersedekah juga</p>
                <p>,dan dikurangin ngegibahnya, yaa. Hehe.</p>
                <P>jangan lupa makin sayang keluarga:</P>
                <p>Ayah, Bunda, Kakak...</p>
                <p>dengan kehadiran kamu</p>
                <p>semoga bisa jadi kebahagiaan untuk orang di sekitarmu.</p>
                <p>sekali lagi HBD ya, Arstia Zita yang sekarang udah</p>
                <p>jadi versi kuat dari versi yang lalu 🩷</p>
                <p>Dari Eryus, -7 Mei 2025</p>
                <p></p>
            </div>
        </div>

        <div id="startScreen">
            <h1>Flappy ZITA</h1>
            <p class="instructions" id="desktopInstructions">Klik Mulai buat terbangin Zita</p>
            <p class="instructions" id="mobileInstructions">Tap layar buat terbangin Zita</p>
            <button id="startBtn">MULAI</button>
        </div>

        <div id="gameOver">
            <h1>Yeuh Cupu kau</h1>
            <p id="finalScore">Score mu: 0</p>
            <button id="restartBtn">MAIN LAGI GA?</button>
        </div>

        <div id="controls">
            <button id="jumpBtn">TERBANG</button>
        </div>
    </div>

    <!-- Audio -->
    <audio id="flapSound" src="iye.mp3" preload="auto"></audio>
    <audio id="hitSound" src="Takkkkkk.mp3" preload="auto"></audio>
    <audio id="scoreSound" src="koin.mp3" preload="auto"></audio>
    <audio id="resetAudio" src="Tak nangis.mp3" preload="auto"></audio>
    <audio id="starwarsSound" src="stecu.mp3" preload="auto"></audio>
    <audio id="mulaiAudio" src="Mulai.mp3" preload="auto"></audio>

    <!-- Burung -->
    <img id="birdImage" src="zite.png" style="display:none">

    <script>
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        const desktopInstructions = document.getElementById('desktopInstructions');
        const mobileInstructions = document.getElementById('mobileInstructions');

        if (isMobile) {
            desktopInstructions.style.display = 'none';
            mobileInstructions.style.display = 'block';
        } else {
            mobileInstructions.style.display = 'none';
        }

        let canvas, ctx;
        let score = 0;
        let gameSpeed = 2;
        let gravity = 0.5;
        let isGameOver = false;
        let isGameStarted = false;
        let animationFrameId;
        let lastPipeTime = 0;
        let isResetting = false;
        let gameCanStart = false;
        let bgFarX = 0;
        let bgNearX = 0;

        const bird = {
            x: 0,
            y: 0,
            width: 0,
            height: 0,
            velocity: 0,
            jump: -10
        };

        const pipes = [];
        let pipeWidth = 0;
        let pipeGap = 0;
        let pipeFrequency = 1500;

        function initGame() {
            const gameContainer = document.getElementById('gameContainer');
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');

            const containerWidth = gameContainer.clientWidth;
            const containerHeight = gameContainer.clientHeight;

            canvas.width = containerWidth;
            canvas.height = containerHeight;

            bird.width = canvas.width * 0.12;
            bird.height = bird.width * 0.9;
            bird.x = canvas.width * 0.2;
            bird.y = canvas.height / 2 - bird.height / 2;
            bird.velocity = 0;

            pipeWidth = canvas.width * 0.15;
            pipeGap = canvas.height * 0.30;
            gameSpeed = canvas.width * 0.005;

            score = 0;
            document.getElementById('score').textContent = score;
            pipes.length = 0;
            isGameOver = false;
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('starwars').style.display = 'none';

            drawBackground();
            drawBird();
        }

        function startGame() {
            document.getElementById('startText').style.display = 'none';
            gameCanStart = false;
            isGameStarted = true;
            document.getElementById('startScreen').style.display = 'none';
            const bgMusic = document.getElementById('mulaiAudio');
            bgMusic.currentTime = 0;
            bgMusic.volume = 0.5;
            bgMusic.play().catch(() => {});

            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            lastPipeTime = performance.now();
            gameLoop();
        }

        window.addEventListener('resize', () => {
            if (!isGameStarted) return;
            initGame();
        });

        function gameLoop(timestamp) {
            if (isGameOver || isResetting) return;
            update(timestamp);
            draw();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function update(timestamp) {
            bird.velocity += gravity;
            bird.y += bird.velocity;

            if (bird.y + bird.height > canvas.height || bird.y < 0) gameOver();

            if (timestamp - lastPipeTime > pipeFrequency) {
                createPipe();
                lastPipeTime = timestamp;

                if (score > 0 && score % 3 === 0) {
                    gameSpeed += 0.2;
                    pipeFrequency = Math.max(1000, pipeFrequency - 50);
                }
            }

            for (let i = pipes.length - 1; i >= 0; i--) {
                pipes[i].x -= gameSpeed;

                if (
                    bird.x < pipes[i].x + pipeWidth &&
                    bird.x + bird.width > pipes[i].x &&
                    (bird.y < pipes[i].topHeight || bird.y + bird.height > pipes[i].topHeight + pipeGap)
                ) {
                    gameOver();
                }

                if (pipes[i].x + pipeWidth < bird.x && !pipes[i].passed) {
                    pipes[i].passed = true;
                    score++;
                    document.getElementById('score').textContent = score;
                    const scoreAudio = document.getElementById('scoreSound');
                    scoreAudio.currentTime = 0;
                    scoreAudio.volume = 0.3;
                    scoreAudio.play().catch(() => {});
                }

                if (pipes[i].x + pipeWidth < 0) pipes.splice(i, 1);
            }

            checkWinCondition();
        }

        function checkWinCondition() {
            if (score >= 6 && document.getElementById('starwars').style.display !== 'block') {
                isGameOver = true;
                const bgMusic = document.getElementById('mulaiAudio');
                bgMusic.pause();
                cancelAnimationFrame(animationFrameId);
                document.getElementById('blocker').style.display = 'block';
                const starwars = document.getElementById('starwars');
                starwars.style.display = 'block';
                createFloatingMinions();
                const starwarsAudio = document.getElementById('starwarsSound');
                starwarsAudio.currentTime = 0;
                starwarsAudio.volume = 0.5;
                starwarsAudio.play();

                setTimeout(() => {
                    starwars.style.display = 'none';
                    document.getElementById('blocker').style.display = 'none';
                    document.getElementById('startScreen').style.display = 'flex';
                    document.getElementById('gameOver').style.display = 'none';
                    isGameStarted = false;
                    isGameOver = false;
                    score = 0;
                    pipes.length = 0;
                    gameSpeed = 2;
                    pipeFrequency = 1500;
                    document.getElementById('score').textContent = score;
                    clearMinions();
                    starwars.style.display = 'none';
                    initGame();
                }, 39000);
            }
        }

        function createFloatingMinions() {
            const minionTemplates = document.querySelectorAll('#minion-templates .minion-img');
            const gameContainer = document.getElementById('gameContainer');
            const containerWidth = gameContainer.clientWidth;
            const safeMargin = containerWidth * 0.2;

            for (let i = 0; i < 24; i++) {
                setTimeout(() => {
                    const randomMinion = minionTemplates[Math.floor(Math.random() * minionTemplates.length)];
                    const minion = randomMinion.cloneNode(true);
                    minion.classList.add('minion');
                    const isLeft = Math.random() > 0.5;
                    const xPos = isLeft 
                        ? Math.random() * safeMargin 
                        : containerWidth - safeMargin + (Math.random() * safeMargin);
                    const yPos = 30 + (Math.random() * 60);
                    minion.style.left = `${xPos}px`;
                    minion.style.top = `${yPos}%`;
                    minion.style.animationDuration = `${8 + Math.random() * 7}s`;
                    minion.style.opacity = '0';
                    gameContainer.appendChild(minion);
                    setTimeout(() => {
                        minion.style.opacity = '0.7';
                        minion.style.transition = 'opacity 1s';
                    }, 100);
                }, i * 500);
            }
        }

        function clearMinions() {
            document.querySelectorAll('.minion').forEach(minion => minion.remove());
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawParallax();
            drawPipes();
            drawBird();
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, canvas.height);
            ctx.lineTo(canvas.width, canvas.height);
            ctx.stroke();
        }

        function drawBackground() {
            const bgGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            bgGradient.addColorStop(0, '#4EC0CA');
            bgGradient.addColorStop(1, '#2BB9E6');
            ctx.fillStyle = bgGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function drawBird() {
            const birdImg = document.getElementById('birdImage');
            if (birdImg.complete) {
                ctx.save();
                ctx.translate(bird.x + bird.width/2, bird.y + bird.height/2);
                ctx.rotate(Math.min(Math.max(bird.velocity * 0.05, -0.3), 0.3));
                if (document.getElementById('countdown').style.display === 'block') {
                    ctx.translate(Math.sin(Date.now()/100) * 5, 0);
                }
                ctx.drawImage(birdImg, -bird.width/2, -bird.height/2, bird.width, bird.height);
                ctx.restore();
            } else {
                ctx.fillStyle = '#FFD700';
                ctx.beginPath();
                ctx.ellipse(bird.x + bird.width/2, bird.y + bird.height/2, 
                           bird.width/2, bird.height/2, 0, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function drawPipes() {
            ctx.fillStyle = '#2ECC71';
            for (const pipe of pipes) {
                ctx.fillRect(pipe.x, 0, pipeWidth, pipe.topHeight);
                ctx.fillStyle = '#27AE60';
                ctx.fillRect(pipe.x - 2, pipe.topHeight - 10, pipeWidth + 4, 10);
                ctx.fillStyle = '#2ECC71';
                // Gambar pipa bawah - INI YANG DIPERBAIKI
                ctx.fillRect(pipe.x, pipe.topHeight + pipeGap, pipeWidth, canvas.height - (pipe.topHeight + pipeGap));
                ctx.fillStyle = '#27AE60';
                ctx.fillRect(pipe.x - 2, pipe.topHeight + pipeGap, pipeWidth + 4, 10);
                ctx.fillStyle = '#2ECC71';
            }
        }

        function drawParallax() {
            const bgFarImg = document.getElementById('bgFar');
            const bgNearImg = document.getElementById('bgNear');
            if (!bgFarImg.complete || !bgNearImg.complete) return;
            const scaledWidth = bgNearImg.width * 0.5;
            const scaledHeight = bgNearImg.height * 0.5;
            const repeatCount = Math.ceil(canvas.width / scaledWidth) + 1;

            for (let i = 0; i < repeatCount; i++) {
                ctx.drawImage(bgFarImg, bgFarX + i * bgFarImg.width, 0, bgFarImg.width, canvas.height);
                ctx.drawImage(bgNearImg, bgNearX + i * scaledWidth, 0, scaledWidth, scaledHeight);
            }

            bgFarX -= 0.5;
            bgNearX -= 1.5;

            if (bgFarX <= -bgFarImg.width) bgFarX = 0;
            if (bgNearX <= -scaledWidth) bgNearX = 0;
        }

        function createPipe() {
            const minHeight = canvas.height * 0.15;
            const maxHeight = canvas.height - pipeGap - minHeight;
            const topHeight = Math.floor(Math.random() * (maxHeight - minHeight)) + minHeight;
            pipes.push({ x: canvas.width, topHeight: topHeight, passed: false });
        }

        function gameOver() {
            isGameOver = true;
            document.getElementById('finalScore').textContent = `Score: ${score}`;
            document.getElementById('gameOver').style.display = 'flex';
            const bgMusic = document.getElementById('mulaiAudio');
            bgMusic.pause();
            const hitAudio = document.getElementById('hitSound');
            hitAudio.currentTime = 0;
            hitAudio.play();
            cancelAnimationFrame(animationFrameId);
        }

        function resetGame() {
            isResetting = true;
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('starwars').style.display = 'none';
            bgFarX = 0;
            bgNearX = 0;
            const resetAudio = document.getElementById('resetAudio');
            resetAudio.currentTime = 0;
            resetAudio.play();
            const countdown = document.getElementById('countdown');
            countdown.style.display = 'block';
            let counter = 3;
            countdown.textContent = counter;
            const countdownInterval = setInterval(() => {
                counter--;
                countdown.textContent = counter;
                if (counter <= 0) {
                    clearInterval(countdownInterval);
                    countdown.style.display = 'none';
                    const startText = document.getElementById('startText');
                    startText.style.display = 'block';
                    gameCanStart = true;
                    initGame();
                    setTimeout(() => {
                        startText.style.display = 'none';
                        isResetting = false;
                        startGame();
                    }, 1500);
                }
            }, 1000);
        }

        function jump() {
            const startText = document.getElementById('startText');
            if (startText.style.display === 'block' && gameCanStart) {
                startText.style.display = 'none';
                isResetting = false;
                startGame();
                return;
            }
            if (!isGameStarted || isGameOver || isResetting) return;
            bird.velocity = bird.jump;
            const flapAudio = document.getElementById('flapSound');
            flapAudio.currentTime = 0;
            flapAudio.play();
        }

        function setupControls() {
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space') {
                    e.preventDefault();
                    jump();
                }
            });

            document.getElementById('jumpBtn').addEventListener('click', jump);
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('restartBtn').addEventListener('click', resetGame);

            window.addEventListener('touchstart', (e) => {
                if (e.target.id !== 'jumpBtn' && e.target.id !== 'restartBtn' && e.target.id !== 'startBtn') {
                    e.preventDefault();
                    jump();
                }
            }, { passive: false });
        }

        document.addEventListener("contextmenu", function (e) {
            e.preventDefault();
        });

        document.addEventListener("keydown", function (e) {
            if (e.key === "F12") e.preventDefault();
            if (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) e.preventDefault();
            if (e.ctrlKey && e.key.toLowerCase() === 'u') e.preventDefault();
        });

        setupControls();
        initGame();
    </script>
</body>
</html>
